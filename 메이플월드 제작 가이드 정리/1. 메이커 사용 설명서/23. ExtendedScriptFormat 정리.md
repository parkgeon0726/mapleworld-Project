##### ==**ExtendedScriptFormat은 프리뷰 기능으로 정식 출시 시 기능이 변경될 수 있음**==

확장된 스크립트 포맷을 사용하는 방법과 mlua 파일 형식 정의를 알아보자

# 확장된 스크립트 포맷 소개
로컬 워크스페이스의 **확장된 스크립트 포맷**(UseExtendedScriptFormat)을 활성화하면 메타데이터 파일과 쌍을 이루는 **mlua 파일**을 생성함
확장된 스크립트 포맷은 Plain Text 형식이므로 파일 공유 도구에서 파일 병합 시 충돌이 발생하더라도 문제 지점을 더욱 수월하게 발견할 수 있음
> **주의!**  
> **UseExtendedScriptFormat은 preview 기능으로 안정성을 보장하지 않음 
> 사용 중 버그가 발생할 수 있으며, 추후 정식 버전 도입 시 preview 기능이 정지될 수도 있음
> 백업 파일 혹은 백업 월드를 만들어 두는 것을 권장함**

# 확장된 스크립트 포맷 활성화
1. **WorldConfig - LocalWorkspace - UseExtendedScriptFormat**를 활성화함 ![[Pasted image 20250815162235.png]]
2. LocalWorkspace로 지정한 경로의 폴더에 Environment 폴더와 mlua 파일이 생성된 것을 확인할 수 있음 ![[Pasted image 20250815162252.png]]

# 확장된 스크립트 포맷 비활성화
UseExtendedScriptFormat는 한 번 활성화되면 비활성화 상태로 되돌릴 수 없음
로컬 워크스페이스 자체를 비활성화 해야함  
로컬 워크스페이스를 비활성화하는 방법은 다음과 같음
1. 로컬 파일을 문제점 이전의 상태로 변경함
2. 메이플스토리 월드 메이커에서 **ReimportAll**을 선택ㄱㄱ
3. **File - Sync To Remote Workspace**를 선택해 현재 로컬 파일을 리모트 워크스페이스에 동기화ㄱㄱ
4. 로컬 폴더에서 **Global - WorldConfig.config** 파일을 엶
5. 내용 중 **"UseExtendedScriptFormat": true**를 **"UseExtendedScriptFormat": false**로 변경하고, 저장ㄱㄱ
6. 메이플스토리 월드 메이커에서 **ReimportAll**을 다시 선택ㄱㄱ
7. 메이커에서 UseExtendedScriptFormat이 비활성화 상태인 것을 확인ㄱㄱ
8. **LocalWorkspace**를 비활성화ㄱㄱ
9. **File - Revisions**에서 문제 발생 이전 버전을 선택해 되돌림
![[Pasted image 20250815162718.png]]

# mlua 파일 소개

mlua 파일은 일정한 형식으로 정의되어 있습니다.

> **주의!  
> 메이커에서 지원하지 않는 기능을 mlua에서 임의로 사용하는 것은 권장하지 않습니다. 현재는 정상 동작하는 것처럼 보일 지라도 추후에 동작하지 않도록 변경될 수 있으니 주의 바랍니다.**

#### 스크립트 엔트리 정의
스크립트 엔트리는 하나의 부모로부터 상속받을 수 있으며, 같은 종류의 스크립트 엔트리끼리만 상속이 가능함
스크립트 엔트리 중 **Component, Item, BTNode, State, Logic**은 상속 받은 부모의 정보가 필수적임 
스크립트 엔트리에서 정의 가능한 스크립트 종류는 아래와 같음
- Component
- Item
- BTNode
- State
- Logic
- Event
- Struct
```
@스크립트 종류
script 이름 extends 상속
end
```

스크립트 엔트리 정의 예시임
```
@Component
script NewComponent extends Component
end
```
#### 프로퍼티 정의
프로퍼티 정의 구성은 다음과 같음
```
Property 타입 프로퍼티이름 = 기본값
```

프로퍼티 정의 예시임
```
Property number NewProperty = 5
```
#### 메소드 정의
메소드는 정의 구성은 다음과 같음
```
method 반환타입 메서드이름 (매개변수타입 매개변수이름)
```

메소드 정의 예시임
```
method void TestMethod(float parameter)
```

#### 이벤트 핸들러 정의
이벤트 핸들러는 EventSender Attribute를 필수로 사용함
```
@EventSender("Self")
handler 핸들러이름(이벤트타입 event)
```

이벤트 핸들러 정의 예시임
```
@EventSender("Self")
handler HandleButtonClickEvent(ButtonClickEvent event)
```

#### 어트리뷰트 정의
어트리뷰트의 매개변수가 필요하지 않은 경우 생략할 수 있음
```
@이름()
@이름(매개변수)
```

어트리뷰트 정의 예시임
```
@EventSender()
@EventSender("Self")
```

